---
created: 2025-11-29
updated: 2025-11-30
status: active
version: 0.2.0
parent: '[[v0.2-prompt_plan]]'
---

# Rackarr v0.2 â€” Implementation Checklist (Revised)

Progress tracker for v0.2-prompt_plan.md execution.

**Spec:** [[v0.2-spec]]
**Prompt Plan:** [[v0.2-prompt_plan]]

---

## Pre-requisite Status

- [x] **P01 (getScreenCTM coordinates):** Complete â€” `src/lib/utils/coordinates.ts` exists
  - [x] screenToSVG() implemented
  - [x] svgToScreen() implemented
  - [x] Tests passing

---

## Phase 1: Technical Foundation

### Prompt 1.1 â€” Migrate Drag-Drop to screenToSVG âœ…

- [x] Write equivalence tests (old vs new coordinate calculation)
- [x] Find all zoomScale parameter usages in drag-drop code
- [x] Find all getBoundingClientRect() + manual zoom compensation
- [x] Refactor calculateDropPosition() to use screenToSVG
- [x] Refactor getDropFeedback() to use screenToSVG
- [x] Update Rack.svelte drop handlers
- [x] Update Canvas.svelte coordinate calculations (if any)
- [x] Remove zoomScale parameters from affected functions
- [x] Run existing drag-drop tests
- [x] All tests pass
- [x] **Commit:** `refactor(dnd): migrate to screenToSVG coordinate utilities`

**Note:** Completed as part of P01 and panzoom integration. Rack.svelte uses screenToSVG at lines 132, 200.

### Prompt 1.2 â€” Install and Configure panzoom âœ…

- [x] Run: `npm install panzoom@^9.4.3`
- [x] Create src/lib/stores/canvas.svelte.ts (panzoom utilities integrated into store)
- [x] Implement setPanzoomInstance()
- [x] Implement disposePanzoom()
- [x] Implement getTransform()
- [x] Write tests for panzoom utilities (canvas-store.test.ts - 28 tests)
- [x] All tests pass
- [x] **Commit:** `feat(canvas): add panzoom utility wrapper`

**Note:** Implemented as canvas.svelte.ts store rather than separate utils file. Commit 6adba57.

### Prompt 1.3 â€” Integrate panzoom into Canvas âœ…

- [x] Write Canvas panzoom integration tests
- [x] Update Canvas.svelte structure (add panzoom-container div wrapper)
- [x] Initialize panzoom on mount
- [x] Dispose panzoom on unmount
- [x] Update handleZoomIn() to use panzoom API (via canvas store)
- [x] Update handleZoomOut() to use panzoom API (via canvas store)
- [x] Remove old CSS transform zoom code
- [x] Store panzoom instance for external access (via canvas store)
- [x] All tests pass
- [x] **Commit:** `feat(canvas): integrate panzoom for zoom and pan`

**Note:** Commit 6adba57. Canvas uses div container instead of SVG g element for panzoom.

### Prompt 1.4 â€” Verify Drag-Drop with panzoom (CRITICAL GATE) âœ…

- [x] Run ALL existing drag-drop tests
- [x] Write test: drop at 50% zoom (covered by coordinates.test.ts equivalence tests)
- [x] Write test: drop at 200% zoom (covered by coordinates.test.ts equivalence tests)
- [x] Write test: drop after pan (covered by coordinates.test.ts pan tests)
- [x] Write test: drop after zoom+pan combination (covered by coordinates.test.ts)
- [x] Fix any failing coordinate calculations (none needed)
- [x] Manual verification at various zoom/pan levels
- [x] All tests pass (689/689)
- [x] **Commit:** Verified via existing test suite

**Note:** Verification passed. coordinates.test.ts contains thorough equivalence tests for screenToSVG at all zoom levels and pan offsets. Rack.svelte correctly uses screenToSVG for all coordinate transformations.

### Prompt 1.5 â€” Fit All Calculation Utilities âœ…

- [x] Write tests for calculateRacksBoundingBox()
- [x] Write tests for calculateFitAll()
- [x] Implement calculateRacksBoundingBox()
- [x] Implement calculateFitAll()
- [x] Verify 48px padding
- [x] Verify 200% zoom cap
- [x] Verify centering calculation
- [x] All tests pass (16 new tests, 705 total)
- [x] **Commit:** `feat(canvas): add fit-all calculation utilities`

**Note:** Commit 6afa320. Created src/lib/utils/canvas.ts with utilities.

### Prompt 1.6 â€” Fit All Button and Integration

- [ ] Create IconFitAll.svelte
- [ ] Add Fit All button to Toolbar
- [ ] Write Toolbar button tests
- [ ] Implement fitAll() function
- [ ] Wire button to fitAll()
- [ ] Add keyboard shortcut 'F'
- [ ] Write keyboard shortcut test
- [ ] Handle prefers-reduced-motion (instant vs animated)
- [ ] All tests pass
- [ ] **Commit:** `feat(canvas): add Fit All zoom button`

---

## Phase 2: Core Features

### Prompt 2.1 â€” Rear View Type Definitions

- [ ] Write type tests for RackView
- [ ] Write type tests for DeviceFace
- [ ] Write tests for default values
- [ ] Add RackView type to index.ts
- [ ] Add DeviceFace type to index.ts
- [ ] Add view property to Rack interface
- [ ] Add face property to PlacedDevice interface
- [ ] Add DEFAULT_RACK_VIEW constant
- [ ] Add DEFAULT_DEVICE_FACE constant
- [ ] All tests pass
- [ ] **Commit:** `feat(types): add rear view type definitions`

### Prompt 2.2 â€” Update Rack Creation with View

- [ ] Write test: rack with default front view
- [ ] Write test: rack with specified rear view
- [ ] Update createRack() to accept view parameter
- [ ] Default to DEFAULT_RACK_VIEW
- [ ] Update layout store addRack action (if needed)
- [ ] Fix any failing tests
- [ ] All tests pass
- [ ] **Commit:** `feat(rack): add view property to rack creation`

### Prompt 2.3 â€” Update Device Placement with Face

- [ ] Write test: device with default front face
- [ ] Write test: device with specified face
- [ ] Find all PlacedDevice creation points
- [ ] Update placeDevice in layout store
- [ ] Update drag-drop placement handlers
- [ ] Default to DEFAULT_DEVICE_FACE
- [ ] All tests pass
- [ ] **Commit:** `feat(device): add face property to device placement`

### Prompt 2.4 â€” Rack View Toggle Component

- [ ] Write RackViewToggle component tests
- [ ] Create RackViewToggle.svelte
- [ ] Implement Front/Rear buttons
- [ ] Add aria-pressed attribute
- [ ] Add proper styling (segmented control)
- [ ] Wire onchange callback
- [ ] All tests pass
- [ ] **Commit:** `feat(ui): add RackViewToggle component`

### Prompt 2.5 â€” Integrate View Toggle into Rack

- [ ] Write Rack view toggle integration tests
- [ ] Write device filtering tests (front view)
- [ ] Write device filtering tests (rear view)
- [ ] Write device filtering tests (both face)
- [ ] Add RackViewToggle to Rack.svelte
- [ ] Create $derived for visibleDevices
- [ ] Add updateRackView action to layout store
- [ ] Wire toggle onchange to store
- [ ] All tests pass
- [ ] **Commit:** `feat(rack): integrate view toggle and device filtering`

### Prompt 2.6 â€” Device Face Assignment in Edit Panel

- [ ] Write test: face selector shown for device
- [ ] Write test: three radio options present
- [ ] Write test: no face selector for rack
- [ ] Add face selector fieldset to EditPanel
- [ ] Add Front/Rear/Both radio buttons
- [ ] Add updateDeviceFace action to layout store
- [ ] Wire radio buttons to store action
- [ ] All tests pass
- [ ] **Commit:** `feat(edit): add device face assignment`

### Prompt 2.7 â€” Rack Duplication Utilities

- [ ] Write test: new rack has different ID
- [ ] Write test: name has (Copy) suffix
- [ ] Write test: preserves rack properties
- [ ] Write test: copies devices with positions/faces
- [ ] Write test: positions copy after original
- [ ] Implement duplicateRack() in rack.ts
- [ ] All tests pass
- [ ] **Commit:** `feat(rack): add rack duplication utility`

### Prompt 2.8 â€” Rack Duplication Store Action and UI

- [ ] Write store test: duplicates rack
- [ ] Write store test: error at 6 rack limit
- [ ] Write keyboard test: Ctrl+D duplicates
- [ ] Add duplicateRack action to layout store
- [ ] Handle 6 rack limit with error return
- [ ] Add to context menu (right-click rack)
- [ ] Add Ctrl/Cmd+D keyboard shortcut
- [ ] Show error toast at limit
- [ ] All tests pass
- [ ] **Commit:** `feat(rack): add rack duplication action and shortcuts`

---

## Phase 3: UI Polish

### Prompt 3.1 â€” Device Library Toggle Button

- [ ] Write test: button renders with text
- [ ] Write test: aria-expanded reflects state
- [ ] Write test: aria-controls points to drawer
- [ ] Write test: active state when open
- [ ] Update Toolbar.svelte leftmost element
- [ ] Add Rackarr icon + "Device Library" text
- [ ] Add proper ARIA attributes
- [ ] Add hover/active/focus styles per spec
- [ ] All tests pass
- [ ] **Commit:** `feat(toolbar): add Device Library toggle button`

### Prompt 3.2 â€” Device Library Drawer Changes

- [ ] Write test: no X close button
- [ ] Write test: has correct id
- [ ] Write test: closes on Escape
- [ ] Write test: closes on D key
- [ ] Remove close button from drawer header
- [ ] Add id="device-library-drawer"
- [ ] Verify keyboard close handlers work
- [ ] All tests pass
- [ ] **Commit:** `refactor(drawer): remove X close button, add device-library-drawer id`

### Prompt 3.3 â€” Rack Title Position Above Rack

- [ ] Write test: title Y is above rack body Y
- [ ] Write test: title is centered horizontally
- [ ] Update Rack.svelte title position (y=-8)
- [ ] Update text-anchor to middle
- [ ] Update export.ts rendering (if separate)
- [ ] All tests pass
- [ ] **Commit:** `fix(ui): position rack title above rack`

### Prompt 3.4 â€” Device Icon Vertical Alignment

- [ ] Write test: alignItems is center
- [ ] Update RackDevice.svelte CSS (flex, align-items: center)
- [ ] Update export SVG rendering (dominant-baseline: middle)
- [ ] All tests pass
- [ ] **Commit:** `fix(ui): vertically center device icons`

### Prompt 3.5 â€” Help Panel Update

- [ ] Write test: GitHub link present
- [ ] Write test: Forgejo link absent
- [ ] Remove Forgejo link from HelpPanel.svelte
- [ ] Verify GitHub link remains
- [ ] All tests pass
- [ ] **Commit:** `docs(help): remove internal Forgejo link`

---

## Phase 4: Data & Migration

### Prompt 4.1 â€” Device Library Import Validation

- [ ] Write test: valid device accepted
- [ ] Write test: missing name rejected
- [ ] Write test: height < 0.5 rejected
- [ ] Write test: height > 100 rejected
- [ ] Write test: invalid category rejected
- [ ] Write test: parseDeviceLibraryImport parses valid JSON
- [ ] Write test: skips invalid entries with count
- [ ] Write test: renames duplicates with (imported)
- [ ] Create src/lib/utils/import.ts
- [ ] Implement validateImportDevice()
- [ ] Implement parseDeviceLibraryImport()
- [ ] All tests pass
- [ ] **Commit:** `feat(import): add device library import validation`

### Prompt 4.2 â€” Device Library Import UI

- [ ] Write test: import button renders
- [ ] Write test: accepts JSON files
- [ ] Add Import button to DevicePalette/DeviceLibrary
- [ ] Add hidden file input
- [ ] Implement file read handler
- [ ] Call parseDeviceLibraryImport
- [ ] Merge imported devices into store
- [ ] Show toast with results
- [ ] All tests pass
- [ ] **Commit:** `feat(import): add device library import UI`

### Prompt 4.3 â€” v0.1 to v0.2 Layout Migration

- [ ] Write test: adds view: front to v0.1 racks
- [ ] Write test: adds face: front to v0.1 devices
- [ ] Write test: preserves existing v0.2 values
- [ ] Write test: updates version to 0.2.0
- [ ] Create/update migrateLayout() in layout.ts
- [ ] Handle missing version (assume 0.1)
- [ ] All tests pass
- [ ] **Commit:** `feat(migration): add v0.1 to v0.2 layout migration`

### Prompt 4.4 â€” Wire Migration into Load Flow

- [ ] Write test: migrates v0.1 file on load
- [ ] Write test: migrates session data on restore
- [ ] Update loadLayout in store to call migrateLayout
- [ ] Update restoreFromSession to call migrateLayout
- [ ] All tests pass
- [ ] **Commit:** `feat(migration): integrate migration into load flows`

---

## Final Verification

### Success Criteria

#### Core Features

- [ ] User can toggle between front/rear rack view
- [ ] Devices can be assigned to front, rear, or both faces
- [ ] "Fit All" zooms canvas to show all racks
- [ ] Racks can be duplicated with all devices
- [ ] Device library can be imported from JSON

#### UI Polish

- [ ] Device Library button (with Rackarr icon) toggles drawer
- [ ] Device Library drawer has no X close button
- [ ] Rack titles appear above racks (canvas and export)
- [ ] Device icons are vertically centred
- [ ] Help panel shows only GitHub link (no Forgejo)

#### Technical Foundation

- [ ] panzoom library integrated for canvas zoom/pan
- [ ] Coordinate handling uses getScreenCTM() for transform-aware positioning
- [ ] Drag-and-drop works correctly at all zoom levels and pan positions

#### Compatibility

- [ ] All existing v0.1 functionality preserved
- [ ] v0.1 layouts load correctly with appropriate defaults

### Final Steps

- [ ] Run full test suite: `npm run test:run`
- [ ] Run E2E tests: `npm run test:e2e`
- [ ] Build verification: `npm run build`
- [ ] Manual testing in browser
- [ ] Update version to 0.2.0 in package.json
- [ ] Update CHANGELOG.md
- [ ] Create git tag: v0.2.0
- [ ] **Commit:** `chore: v0.2.0 release`

---

## Summary

| Phase                   | Prompts | Status      |
| ----------------------- | ------- | ----------- |
| Pre-requisite (P01)     | â€”       | âœ… Complete |
| 1. Technical Foundation | 1.1-1.6 | 5/6 ðŸŸ¡      |
| 2. Core Features        | 2.1-2.8 | 0/8 â¬œ      |
| 3. UI Polish            | 3.1-3.5 | 0/5 â¬œ      |
| 4. Data & Migration     | 4.1-4.4 | 0/4 â¬œ      |
| **TOTAL**               | **23**  | **6/23**    |

---

## Quick Commands

```bash
# Development
npm run dev          # Start dev server
npm run test         # Run unit tests (watch)
npm run test:run     # Run unit tests (CI)
npm run test:e2e     # Run E2E tests
npm run build        # Production build

# Git
git add -A && git commit  # Pre-commit hooks run automatically
```

---

_Checklist generated from v0.2-prompt_plan.md (revised)_
