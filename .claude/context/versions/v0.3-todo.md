---
created: 2025-11-30
updated: 2025-11-30
version: 0.3.0
status: ready
---

# Rackarr v0.3 — Implementation Checklist

**Spec:** [[v0.3-spec|v0.3-spec.md]]
**Prompts:** [[v0.3-prompt_plan|v0.3-prompt_plan.md]]
**Target:** Mobile & PWA Support

---

## Pre-Implementation Checklist

- [ ] v0.2 is complete and merged to main
- [ ] All v0.2 tests passing
- [ ] v0.2 tag created
- [ ] Development environment ready
- [ ] Mobile emulator/simulator configured
- [ ] Real test device available (iPhone or Android)

---

## Phase 0: Foundation & Platform Detection

### Prompt 0.1 — Platform Detection Utilities

**File:** `src/lib/utils/platform.ts`

- [ ] Create `PlatformCapabilities` interface
  - [ ] `hasTouch: boolean`
  - [ ] `hasMouse: boolean`
  - [ ] `hasKeyboard: boolean`
  - [ ] `screenWidth: number`
  - [ ] `screenHeight: number`
  - [ ] `isStandalone: boolean`
  - [ ] `prefersReducedMotion: boolean`
- [ ] Create `InteractionMode` type (`'desktop' | 'mobile' | 'hybrid'`)
- [ ] Implement `detectPlatform()` function
  - [ ] Feature detection for touch (`ontouchstart`, `maxTouchPoints`)
  - [ ] Feature detection for mouse (`pointer: fine`)
  - [ ] Check `display-mode: standalone` for PWA
  - [ ] Check `prefers-reduced-motion`
- [ ] Implement `getInteractionMode()` function
- [ ] Implement `isMobileViewport()` function (< 768px)
- [ ] Implement `isPhoneViewport()` function (< 480px)

**File:** `src/lib/stores/platform.svelte.ts`

- [ ] Create platform store with $state
  - [ ] `capabilities: PlatformCapabilities`
  - [ ] `interactionMode: InteractionMode`
  - [ ] `viewportWidth: number`
  - [ ] `viewportHeight: number`
- [ ] Create derived states
  - [ ] `isMobile`
  - [ ] `isPhone`
  - [ ] `isDesktop`
  - [ ] `isTablet`
  - [ ] `supportsTouch`
- [ ] Add resize listener with debounce (100ms)
- [ ] Add matchMedia listeners for capability changes

**Tests:** `src/tests/platform.test.ts`

- [ ] Test: detectPlatform returns hasTouch true when touch events available
- [ ] Test: detectPlatform returns hasMouse true when pointer: fine matches
- [ ] Test: getInteractionMode returns 'desktop' for mouse-only device
- [ ] Test: getInteractionMode returns 'mobile' for touch-only device
- [ ] Test: getInteractionMode returns 'hybrid' for touch+mouse device
- [ ] Test: isMobileViewport returns true for width < 768
- [ ] Test: isPhoneViewport returns true for width < 480
- [ ] Test: platform store updates on viewport resize

**Commit:** `feat(platform): add platform detection utilities and store`

---

### Prompt 0.2 — CSS Breakpoints and Responsive Foundation

**File:** `src/app.css`

- [ ] Add breakpoint CSS custom properties
  - [ ] `--breakpoint-phone: 480px`
  - [ ] `--breakpoint-tablet: 768px`
  - [ ] `--breakpoint-desktop: 1024px`
- [ ] Add mobile-specific CSS custom properties
  - [ ] `--touch-target-min: 48px`
  - [ ] `--mobile-toolbar-height: 56px`
  - [ ] `--mobile-bottom-sheet-handle: 32px`
  - [ ] `--mobile-rack-navigator-height: 48px`
- [ ] Add utility classes
  - [ ] `.mobile-only` (hidden on desktop)
  - [ ] `.desktop-only` (hidden on mobile)
  - [ ] `.touch-target` (minimum 48px dimensions)
- [ ] Add media queries for utility classes
  - [ ] `@media (max-width: 767px)` for mobile
  - [ ] `@media (min-width: 768px)` for tablet+
  - [ ] `@media (min-width: 1024px)` for desktop
- [ ] Add safe area support for notched devices
  - [ ] `--safe-area-top`
  - [ ] `--safe-area-bottom`
  - [ ] `--safe-area-left`
  - [ ] `--safe-area-right`

**Tests:** `src/tests/responsive.test.ts`

- [ ] Test: CSS custom properties are defined for breakpoints
- [ ] Test: mobile-only class hidden on desktop viewport
- [ ] Test: desktop-only class hidden on mobile viewport
- [ ] Test: touch-target class applies minimum dimensions

**Commit:** `feat(css): add responsive breakpoints and utility classes`

---

## Phase 1: Responsive Toolbar

### Prompt 1.1 — Compact Mobile Toolbar

**File:** `src/lib/components/Toolbar.svelte`

- [ ] Import platform store
- [ ] Add conditional rendering for mobile vs desktop
- [ ] Desktop layout unchanged (≥768px)
- [ ] Mobile layout (<768px)
  - [ ] Height: 56px
  - [ ] Left: Menu icon (opens MobileMenuSheet)
  - [ ] Center: Rack name (truncated, tappable)
  - [ ] Right: More menu button (⋮)
  - [ ] Optional: View toggle (Front/Rear)

**File:** `src/lib/components/MobileMenuSheet.svelte`

- [ ] Create component with props
  - [ ] `open: boolean`
- [ ] Implement full-height slide-up sheet
- [ ] Add menu items
  - [ ] New Rack button
  - [ ] Save Layout button
  - [ ] Load Layout button
  - [ ] Export button
  - [ ] Divider
  - [ ] Theme toggle (Dark/Light)
  - [ ] Help & About link
  - [ ] App version
- [ ] Add backdrop overlay
- [ ] Add slide animation
- [ ] Handle close (backdrop tap, swipe down)
- [ ] Dispatch events
  - [ ] `close`
  - [ ] `action` with action type

**Tests:** `src/tests/MobileToolbar.test.ts`

- [ ] Test: Mobile toolbar renders on viewport < 768px
- [ ] Test: Desktop toolbar renders on viewport >= 768px
- [ ] Test: Mobile toolbar shows rack name truncated
- [ ] Test: More menu button opens action sheet
- [ ] Test: Menu sheet contains all action buttons
- [ ] Test: Menu sheet closes on backdrop tap
- [ ] Test: Menu sheet dispatches correct action events

**Commit:** `feat(toolbar): add responsive mobile toolbar with menu sheet`

---

### Prompt 1.2 — Mobile Action Sheet Component

**File:** `src/lib/components/ActionSheet.svelte`

- [ ] Create component with props
  - [ ] `open: boolean`
  - [ ] `title?: string`
  - [ ] `actions: Array<{ id, label, icon?, destructive? }>`
- [ ] Implement slide-up from bottom
- [ ] Add backdrop overlay
- [ ] Add handle bar at top
- [ ] Render action buttons list
- [ ] Style destructive actions in red
- [ ] Add Cancel button (always present)
- [ ] Add accessibility
  - [ ] `role="dialog"`
  - [ ] `aria-modal="true"`
  - [ ] Focus trap
  - [ ] Escape closes
- [ ] Add animations
  - [ ] Slide up: 200ms ease-out
  - [ ] Slide down: 150ms ease-in
  - [ ] Respect prefers-reduced-motion
- [ ] Dispatch events
  - [ ] `select` with actionId
  - [ ] `cancel`
  - [ ] `close`

**File:** `src/lib/components/SheetHandle.svelte`

- [ ] Create handle bar component
  - [ ] 40px wide, 4px tall, rounded
  - [ ] Centered horizontally
  - [ ] Subtle color (--colour-border)

- [ ] Update MobileMenuSheet to use ActionSheet

**Tests:** `src/tests/ActionSheet.test.ts`

- [ ] Test: ActionSheet renders when open=true
- [ ] Test: ActionSheet hidden when open=false
- [ ] Test: ActionSheet shows all provided actions
- [ ] Test: Clicking action dispatches select event with actionId
- [ ] Test: Cancel button dispatches cancel event
- [ ] Test: Backdrop tap dispatches close event
- [ ] Test: Destructive actions have red styling
- [ ] Test: Escape key closes action sheet

**Commit:** `feat(components): add ActionSheet component for mobile`

---

## Phase 2: Bottom Sheet System

### Prompt 2.1 — Bottom Sheet Base Component

**File:** `src/lib/components/BottomSheet.svelte`

- [ ] Create component with props
  - [ ] `open: boolean`
  - [ ] `state: 'collapsed' | 'half' | 'expanded' | 'hidden'`
  - [ ] `collapsedHeight: number` (default: 80)
  - [ ] `halfHeight: string` (default: '40vh')
  - [ ] `expandedHeight: string` (default: '90vh')
  - [ ] `title?: string`
- [ ] Implement three visible states
- [ ] Add swipe up/down gesture handling
- [ ] Add tap handle to toggle collapsed/half
- [ ] Add smooth spring animation between states
- [ ] Make content scrollable when expanded
- [ ] Add visual structure
  - [ ] Handle bar
  - [ ] Optional title
  - [ ] Content slot
- [ ] Style fixed positioning
  - [ ] `position: fixed`
  - [ ] `bottom: 0`
  - [ ] Border radius on top corners
  - [ ] Box shadow
  - [ ] Proper z-index
- [ ] Dispatch `statechange` event

**File:** `src/lib/utils/gestures.ts`

- [ ] Implement `calculateSnapState()` function
- [ ] Implement `getSwipeVelocity()` function
- [ ] Implement `getSwipeDirection()` function

**Tests:** `src/tests/BottomSheet.test.ts`

- [ ] Test: BottomSheet renders in collapsed state by default
- [ ] Test: BottomSheet shows correct height for collapsed state
- [ ] Test: BottomSheet shows correct height for half state
- [ ] Test: BottomSheet shows correct height for expanded state
- [ ] Test: BottomSheet hidden when state is 'hidden'
- [ ] Test: Handle tap toggles between collapsed and half
- [ ] Test: State change dispatches statechange event
- [ ] Test: Content is scrollable in expanded state

**Commit:** `feat(components): add BottomSheet component`

---

### Prompt 2.2 — Device Library Bottom Sheet

**File:** `src/lib/components/DeviceLibrarySheet.svelte`

- [ ] Wrap BottomSheet with Device Library content
- [ ] Add internal state
  - [ ] `sheetState`
  - [ ] `searchQuery`
  - [ ] `selectedDeviceId`
- [ ] Implement collapsed view (80px)
  - [ ] Handle bar
  - [ ] "Device Library" title
  - [ ] Device count badge
- [ ] Implement half view (40vh)
  - [ ] Search field
  - [ ] Scrollable device list (collapsed categories)
  - [ ] "Add Device" button
- [ ] Implement expanded view (90vh)
  - [ ] Full device list with expanded categories
  - [ ] Import button
- [ ] Add device selection for placement
  - [ ] Tap device sets selectedDeviceId
  - [ ] Show selected state (checkmark, highlight)
  - [ ] Show toast with placement hint
  - [ ] Auto-collapse sheet

**File:** `src/lib/components/DeviceLibraryItem.svelte`

- [ ] Create mobile-optimized device list item
  - [ ] Min height: 48px
  - [ ] Category icon (24px)
  - [ ] Device name (truncated)
  - [ ] Height badge ("2U")
  - [ ] Selected state indicator
- [ ] Dispatch `select` event

**File:** `src/lib/stores/ui.svelte.ts` (updates)

- [ ] Add `deviceLibrarySheetState`
- [ ] Add `selectedLibraryDevice`
- [ ] Add `setDeviceLibrarySheetState()` action
- [ ] Add `selectLibraryDeviceForPlacement()` action
- [ ] Add `clearLibraryDeviceSelection()` action

**File:** `src/App.svelte` (updates)

- [ ] Add conditional rendering for mobile Device Library

**Tests:** `src/tests/DeviceLibrarySheet.test.ts`

- [ ] Test: Sheet renders in collapsed state showing title and count
- [ ] Test: Sheet shows search field in half state
- [ ] Test: Sheet shows full device list in expanded state
- [ ] Test: Tapping device selects it for placement
- [ ] Test: Selected device shows visual indicator
- [ ] Test: Selection auto-collapses sheet
- [ ] Test: Search filters device list

**Commit:** `feat(mobile): add Device Library bottom sheet`

---

### Prompt 2.3 — Edit Panel Bottom Sheet

**File:** `src/lib/components/EditSheet.svelte`

- [ ] Create modal sheet component
- [ ] Auto-open when device/rack selected on mobile
- [ ] Implement slide-up animation (60-80% viewport)
- [ ] Add backdrop dimming
- [ ] Handle close (swipe down, tap backdrop)
- [ ] Implement device editing contents
  - [ ] Device name (read-only)
  - [ ] Position spinner (editable)
  - [ ] Mounted Face radio (Front/Rear/Both)
  - [ ] Move to Rack dropdown
  - [ ] Remove from Rack button (destructive)
- [ ] Implement rack editing contents
  - [ ] Rack name (editable)
  - [ ] Height in U (editable)
  - [ ] Utilisation display
  - [ ] Duplicate Rack button
  - [ ] Delete Rack button (destructive)

**File:** `src/lib/components/PositionSpinner.svelte`

- [ ] Create touch-friendly number input
  - [ ] Large minus button (48px)
  - [ ] Current value display
  - [ ] Large plus button (48px)
- [ ] Add min/max constraints
- [ ] Add label prop
- [ ] Dispatch `change` event

**File:** `src/App.svelte` (updates)

- [ ] Add conditional rendering for EditSheet on mobile

**Tests:** `src/tests/EditSheet.test.ts`

- [ ] Test: EditSheet opens when device selected on mobile
- [ ] Test: EditSheet opens when rack selected on mobile
- [ ] Test: EditSheet shows device properties when device selected
- [ ] Test: EditSheet shows rack properties when rack selected
- [ ] Test: Position spinner changes device position
- [ ] Test: Remove button removes device from rack
- [ ] Test: Swipe down closes sheet
- [ ] Test: Backdrop tap closes sheet

**Commit:** `feat(mobile): add Edit Panel bottom sheet`

---

## Phase 3: Mobile Canvas & Navigation

### Prompt 3.1 — Rack Navigator Component

**File:** `src/lib/components/RackNavigator.svelte`

- [ ] Create fixed bar component
- [ ] Implement layout: `◀  Rack X of Y  ▶  [+]`
- [ ] Add Previous button (disabled if first rack)
- [ ] Add position indicator text
- [ ] Add Next button (disabled if last rack)
- [ ] Add Quick add button (+)
- [ ] Style with 48px height
- [ ] Use 48px touch targets for buttons
- [ ] Dispatch events
  - [ ] `navigate` with direction
  - [ ] `add`

**File:** `src/lib/stores/mobileNavigation.svelte.ts`

- [ ] Create store with state
  - [ ] `currentRackIndex: number`
- [ ] Add derived states
  - [ ] `currentRack`
  - [ ] `canNavigatePrev`
  - [ ] `canNavigateNext`
  - [ ] `rackCount`
- [ ] Add actions
  - [ ] `navigateToRack(index)`
  - [ ] `navigatePrev()`
  - [ ] `navigateNext()`
  - [ ] `syncWithSelection()`

**File:** `src/App.svelte` (updates)

- [ ] Add RackNavigator to mobile layout structure

**Tests:** `src/tests/RackNavigator.test.ts`

- [ ] Test: Navigator shows current rack position
- [ ] Test: Previous button disabled on first rack
- [ ] Test: Next button disabled on last rack
- [ ] Test: Clicking next navigates to next rack
- [ ] Test: Clicking prev navigates to previous rack
- [ ] Test: Add button opens new rack form
- [ ] Test: Position indicator updates on navigation

**Commit:** `feat(mobile): add rack navigator component`

---

### Prompt 3.2 — Single Rack Mobile View

**File:** `src/lib/components/Canvas.svelte` (updates)

- [ ] Add mobile view mode detection
- [ ] Keep desktop multi-rack layout unchanged
- [ ] Add mobile single-rack conditional rendering

**File:** `src/lib/components/SingleRackView.svelte`

- [ ] Create single rack view component
- [ ] Render rack full width with padding
- [ ] Enable vertical scroll if needed
- [ ] Center rack horizontally
- [ ] Enable touch events for placement
- [ ] Integrate with panzoom
  - [ ] Enable pinch-to-zoom
  - [ ] Double-tap to reset
  - [ ] Disable pan (use swipe for navigation)

**File:** `src/lib/components/MobileEmptyState.svelte`

- [ ] Create mobile empty state
- [ ] Centered message
- [ ] "Create your first rack" prompt
- [ ] Large "New Rack" button (primary)
- [ ] "Load Layout" button (secondary)

**File:** `src/lib/components/Canvas.svelte` (updates)

- [ ] Update touch handling for mobile
  - [ ] Accept taps for placement
  - [ ] Accept pinch for zoom
  - [ ] Pass swipe to rack navigation
  - [ ] Disable drag-and-drop on mobile

**Tests:** `src/tests/SingleRackView.test.ts`

- [ ] Test: SingleRackView renders rack full width on mobile
- [ ] Test: SingleRackView shows correct rack from navigation
- [ ] Test: Empty state shown when no racks exist
- [ ] Test: Tapping U slot triggers placement when device selected
- [ ] Test: Pinch gesture triggers zoom
- [ ] Test: Double-tap resets zoom to fit

**Commit:** `feat(mobile): add single rack mobile view`

---

## Phase 4: Touch Gesture System

### Prompt 4.1 — Hammer.js Integration

**Dependencies:**

- [ ] Run `npm install @egjs/hammerjs`

**File:** `src/lib/utils/hammer.ts`

- [ ] Add type definitions
  - [ ] `HammerTapEvent`
  - [ ] `HammerPinchEvent`
  - [ ] `HammerPanEvent`
  - [ ] `HammerPressEvent`
- [ ] Create `GestureCallbacks` interface
- [ ] Implement `setupCanvasGestures()` function
  - [ ] Initialize Hammer instance
  - [ ] Enable pinch recognizer
  - [ ] Configure horizontal pan
  - [ ] Return cleanup function

**File:** `src/lib/actions/gestures.ts`

- [ ] Create Svelte action `use:gestures`
- [ ] Initialize Hammer on mount
- [ ] Cleanup on destroy
- [ ] Update callbacks on parameter change

**File:** `src/lib/components/Canvas.svelte` (updates)

- [ ] Add gesture action with callbacks
  - [ ] `onTap`
  - [ ] `onPinch`
  - [ ] `onPanLeft`
  - [ ] `onPanRight`
  - [ ] `onDoubleTap`

**File:** `src/lib/stores/canvas.svelte.ts` (updates)

- [ ] Disable panzoom's built-in touch handling
  - [ ] `smoothScroll: false`
  - [ ] `zoomDoubleClickSpeed: 1`
  - [ ] `beforeMouseDown: () => false`
  - [ ] `beforeTouch: () => false`

**Tests:** `src/tests/hammer.test.ts`

- [ ] Test: setupCanvasGestures returns cleanup function
- [ ] Test: Tap callback invoked on tap gesture
- [ ] Test: Pinch callback invoked on pinch gesture
- [ ] Test: Pan callbacks invoked on horizontal swipe
- [ ] Test: Press callback invoked on long press
- [ ] Test: Cleanup function removes event listeners

**Commit:** `feat(gestures): integrate Hammer.js for touch handling`

---

### Prompt 4.2 — Pinch-to-Zoom Integration

**File:** `src/lib/stores/canvas.svelte.ts` (updates)

- [ ] Add mobile zoom methods
  - [ ] `pinchZoom(scale, centerX, centerY)`
  - [ ] `pinchZoomEnd()`
  - [ ] `doubleTapReset()`
- [ ] Add pinch tracking state
  - [ ] `isPinching: boolean`
  - [ ] `pinchStartZoom: number`

**File:** `src/lib/utils/pinchZoom.ts`

- [ ] Implement `calculatePinchZoom()` function
- [ ] Implement `smoothZoomTo()` function
  - [ ] Animate zoom change
  - [ ] Respect prefers-reduced-motion

**File:** `src/lib/components/SingleRackView.svelte` (updates)

- [ ] Add pinch gesture handlers
  - [ ] `handlePinchStart`
  - [ ] `handlePinch`
  - [ ] `handlePinchEnd`
  - [ ] `handleDoubleTap`
- [ ] Show zoom percentage indicator during pinch

**Tests:** `src/tests/pinchZoom.test.ts`

- [ ] Test: Pinch out increases zoom level
- [ ] Test: Pinch in decreases zoom level
- [ ] Test: Zoom clamped to minimum 25%
- [ ] Test: Zoom clamped to maximum 200%
- [ ] Test: Double-tap resets zoom to fit-all
- [ ] Test: Pinch centers on gesture point

**Commit:** `feat(zoom): implement pinch-to-zoom with panzoom integration`

---

### Prompt 4.3 — Swipe Navigation Between Racks

**File:** `src/lib/stores/mobileNavigation.svelte.ts` (updates)

- [ ] Add swipe navigation state
  - [ ] `isTransitioning: boolean`
  - [ ] `transitionDirection: 'left' | 'right' | null`
- [ ] Add actions
  - [ ] `swipeToNext()`
  - [ ] `swipeToPrev()`

**File:** `src/lib/components/SingleRackView.svelte` (updates)

- [ ] Add swipe gesture handlers
  - [ ] `handlePanLeft`
  - [ ] `handlePanRight`
- [ ] Check velocity threshold (0.3)

**CSS for transitions:**

- [ ] Add `.rack-container` transition styles
- [ ] Add `.transitioning-left` class
- [ ] Add `.transitioning-right` class

**Visual feedback:**

- [ ] Add horizontal offset during pan
- [ ] Add edge peek of adjacent rack
- [ ] Add resistance at first/last rack

**Conflict prevention:**

- [ ] Disable swipe during pinch-zoom
- [ ] Disable swipe when bottom sheet expanded
- [ ] Disable swipe when EditSheet open

**Tests:** `src/tests/swipeNavigation.test.ts`

- [ ] Test: Swipe left navigates to next rack
- [ ] Test: Swipe right navigates to previous rack
- [ ] Test: Slow swipe snaps back to current rack
- [ ] Test: Swipe at first rack shows resistance
- [ ] Test: Swipe at last rack shows resistance
- [ ] Test: Navigation disabled during pinch
- [ ] Test: Transition animation plays between racks

**Commit:** `feat(navigation): implement swipe navigation between racks`

---

## Phase 5: Two-Tap Device Placement

### Prompt 5.1 — Device Selection State

**File:** `src/lib/stores/ui.svelte.ts` (updates)

- [ ] Add `PlacementMode` type
- [ ] Add `placementMode` state
- [ ] Add derived states
  - [ ] `isPlacingDevice`
  - [ ] `placingDeviceId`
- [ ] Add actions
  - [ ] `startDevicePlacement(deviceId, deviceName)`
  - [ ] `cancelDevicePlacement()`
  - [ ] `completePlacement()`

**File:** `src/lib/components/DeviceLibrarySheet.svelte` (updates)

- [ ] Update device tap handler
  - [ ] Call `startDevicePlacement()`
  - [ ] Show toast with placement hint
  - [ ] Auto-collapse sheet
- [ ] Add selected device styling

**File:** `src/lib/components/DeviceLibraryItem.svelte` (updates)

- [ ] Add `selected` prop
- [ ] Add selected styling (highlight, checkmark)

**Cancel triggers:**

- [ ] Tap same device → deselect
- [ ] Tap outside rack → cancel
- [ ] Press Escape → cancel
- [ ] Open menu → cancel
- [ ] Navigate rack → keep selection

**Tests:** `src/tests/placementState.test.ts`

- [ ] Test: startDevicePlacement sets placing mode
- [ ] Test: isPlacingDevice true when in placing mode
- [ ] Test: Device shows selected state when being placed
- [ ] Test: cancelDevicePlacement resets to none mode
- [ ] Test: Tapping same device cancels placement
- [ ] Test: Escape key cancels placement
- [ ] Test: Selection persists across rack navigation

**Commit:** `feat(placement): add device selection state for two-tap flow`

---

### Prompt 5.2 — U Slot Tap Targets

**File:** `src/lib/components/Rack.svelte` (updates)

- [ ] Add conditional rendering of U slot targets in placement mode

**File:** `src/lib/components/USlotTarget.svelte`

- [ ] Create component with props
  - [ ] `uPosition: number`
  - [ ] `rackId: string`
  - [ ] `deviceHeight: number`
  - [ ] `valid: boolean`
- [ ] Render invisible tap target (extended to 48px)
- [ ] Add visual preview of placement
- [ ] Style valid positions (green tint)
- [ ] Style invalid positions (red tint, disabled)
- [ ] Dispatch `tap` event

**File:** `src/lib/components/Rack.svelte` (updates)

- [ ] Add `handleUSlotTap()` handler
  - [ ] Call `placeDevice()` if valid
  - [ ] Call `completePlacement()` on success
  - [ ] Show success/error toast

**Placement preview:**

- [ ] Show ghost outline on hover/touch
- [ ] Use device color at 40% opacity
- [ ] Show device name

**Tests:** `src/tests/USlotTarget.test.ts`

- [ ] Test: U slot targets render when in placement mode
- [ ] Test: Tap on valid slot places device
- [ ] Test: Tap on invalid slot shows error
- [ ] Test: Placement preview shows ghost device
- [ ] Test: Touch target meets 48px minimum
- [ ] Test: Multi-U device shows preview for all occupied slots

**Commit:** `feat(placement): add U slot tap targets for device placement`

---

### Prompt 5.3 — Placement Feedback and Animation

**File:** `src/lib/utils/haptics.ts`

- [ ] Implement `canVibrate()` function
- [ ] Implement `vibrate()` function
- [ ] Define haptic patterns
  - [ ] `HAPTIC_TAP: 10`
  - [ ] `HAPTIC_SUCCESS: [10, 50, 10]`
  - [ ] `HAPTIC_ERROR: [50, 50, 50]`

**Success animation:**

- [ ] Add green flash on U slots
- [ ] Add "drops in" animation (scale 1.1 to 1)
- [ ] Trigger haptic success
- [ ] Show success toast

**Error animation:**

- [ ] Add red flash on conflicting slots
- [ ] Add shake animation
- [ ] Trigger haptic error
- [ ] Show error toast with conflict info

**CSS animations:**

- [ ] Add `@keyframes device-place`
- [ ] Add `.device.just-placed` class
- [ ] Add `@keyframes shake`
- [ ] Add `.u-slot-target.error` class

**File:** `src/lib/components/USlotTarget.svelte` (updates)

- [ ] Add animation state
  - [ ] `justPlaced: boolean`
  - [ ] `error: boolean`

**Integration:**

- [ ] Call `vibrate()` in placement handler

**Tests:** `src/tests/placementFeedback.test.ts`

- [ ] Test: Success placement shows green flash
- [ ] Test: Success placement triggers drop animation
- [ ] Test: Error placement shows red flash
- [ ] Test: Error placement triggers shake animation
- [ ] Test: Haptic feedback called on placement
- [ ] Test: Toast shown with device name and position

**Commit:** `feat(feedback): add placement feedback animations and haptics`

---

### Prompt 5.4 — Long-Press Drag Mode (Optional)

**File:** `src/lib/components/RackDevice.svelte` (updates)

- [ ] Add long-press detection via gestures action
- [ ] Implement long-press flow
  - [ ] 500ms hold triggers drag
  - [ ] Device "lifts" with shadow
  - [ ] Haptic feedback
  - [ ] Device follows finger
  - [ ] Valid drop zones highlight
  - [ ] Release to drop or cancel

**File:** `src/lib/stores/selection.svelte.ts` (updates)

- [ ] Add drag state
  - [ ] `isDragging: boolean`
  - [ ] `deviceId: string | null`
  - [ ] `sourcePosition: number`
- [ ] Add actions
  - [ ] `startDrag()`
  - [ ] `updateDragPosition()`
  - [ ] `endDrag()`
  - [ ] `cancelDrag()`

**CSS for drag:**

- [ ] Add `.device.dragging` styles (scale, shadow, z-index)
- [ ] Add `.device.drag-ghost` styles (opacity)

**Drop zone highlighting:**

- [ ] Valid positions: green outline
- [ ] Invalid positions: red outline
- [ ] Original position: dashed outline

**Drop handling:**

- [ ] Calculate nearest valid U position
- [ ] Move device if valid
- [ ] Return to original if invalid
- [ ] Cancel if outside rack

**Tests:** `src/tests/mobileDrag.test.ts`

- [ ] Test: Long-press (500ms) initiates drag mode
- [ ] Test: Short press does not initiate drag
- [ ] Test: Device follows finger during drag
- [ ] Test: Drop on valid position moves device
- [ ] Test: Drop on invalid position returns to original
- [ ] Test: Drag can be cancelled by moving outside rack
- [ ] Test: Ghost shows at original position during drag

**Commit:** `feat(mobile): add long-press drag mode for devices`

---

## Phase 6: PWA Infrastructure

### Prompt 6.1 — Web App Manifest

**File:** `public/manifest.json`

- [ ] Create manifest with required fields
  - [ ] `name: "Rackarr"`
  - [ ] `short_name: "Rackarr"`
  - [ ] `description`
  - [ ] `start_url: "/"`
  - [ ] `display: "standalone"`
  - [ ] `background_color: "#1a1a1a"`
  - [ ] `theme_color: "#1a1a1a"`
  - [ ] `orientation: "any"`
  - [ ] `categories`
  - [ ] `icons` array (192, 512)

**Files:** `public/icons/`

- [ ] Create `icon-192.png` (192x192)
- [ ] Create `icon-512.png` (512x512)

**File:** `index.html` (updates)

- [ ] Add `<link rel="manifest">`
- [ ] Add `<meta name="theme-color">`
- [ ] Add Apple-specific meta tags
  - [ ] `apple-mobile-web-app-capable`
  - [ ] `apple-mobile-web-app-status-bar-style`
  - [ ] `apple-mobile-web-app-title`
  - [ ] `apple-touch-icon`

**File:** `src/lib/utils/pwa.ts`

- [ ] Implement `isPWAInstalled()` function
- [ ] Implement `canInstallPWA()` function
- [ ] Add install prompt handling
  - [ ] Store deferred prompt
  - [ ] Show custom install UI
  - [ ] Trigger native prompt

**Tests:** `src/tests/pwa.test.ts`

- [ ] Test: manifest.json is valid JSON
- [ ] Test: manifest has required fields
- [ ] Test: isPWAInstalled returns true in standalone mode
- [ ] Test: canInstallPWA checks for browser support

**Commit:** `feat(pwa): add web app manifest and icons`

---

### Prompt 6.2 — Service Worker

**File:** `public/sw.js`

- [ ] Define `CACHE_NAME` constant
- [ ] Define `APP_SHELL` files array
- [ ] Add `install` event handler
  - [ ] Cache app shell files
  - [ ] Call `skipWaiting()`
- [ ] Add `activate` event handler
  - [ ] Delete old caches
  - [ ] Call `clients.claim()`
- [ ] Add `fetch` event handler
  - [ ] Cache-first strategy
  - [ ] Fallback to index.html

**File:** `src/main.ts` (updates)

- [ ] Add service worker registration
  - [ ] Check for support
  - [ ] Register on load
  - [ ] Log success/error

**File:** `vite.config.ts` (updates)

- [ ] Configure sw.js copy to dist

**File:** `src/lib/stores/offline.svelte.ts`

- [ ] Create store with state
  - [ ] `isOnline: boolean`
  - [ ] `serviceWorkerReady: boolean`
- [ ] Add event listeners
  - [ ] `online` event
  - [ ] `offline` event

**Offline indicator:**

- [ ] Add cloud-off icon to toolbar when offline
- [ ] Add subtle grey background tint

**Tests:** `src/tests/serviceWorker.test.ts`

- [ ] Test: Service worker registers successfully
- [ ] Test: App shell files are cached on install
- [ ] Test: Cached responses returned when offline
- [ ] Test: Old caches deleted on activate
- [ ] Test: isOnline updates on network change

**Commit:** `feat(pwa): add service worker for offline support`

---

### Prompt 6.3 — Install Prompt

**File:** `src/lib/components/InstallPrompt.svelte`

- [ ] Create banner component
- [ ] Implement visibility conditions
  - [ ] Not already installed
  - [ ] Browser supports installation
  - [ ] 2+ visits
  - [ ] User has interacted
  - [ ] Not dismissed in last 7 days
- [ ] Add Install button (triggers native prompt)
- [ ] Add Not Now button (dismiss for 7 days)

**File:** `src/lib/stores/installPrompt.svelte.ts`

- [ ] Create store with state
  - [ ] `deferredPrompt`
  - [ ] `canShowPrompt`
  - [ ] `wasPromptShown`
  - [ ] `lastDismissed`
- [ ] Add effects
  - [ ] Listen for `beforeinstallprompt`
  - [ ] Check localStorage for dismissal
- [ ] Add actions
  - [ ] `showInstallPrompt()`
  - [ ] `dismissPrompt()`
  - [ ] `triggerInstall()`

**File:** `src/lib/utils/pwa.ts` (updates)

- [ ] Add `getVisitCount()`
- [ ] Add `incrementVisitCount()`
- [ ] Add `hasUserInteracted()`
- [ ] Add `setUserInteracted()`
- [ ] Add `getLastDismissed()`
- [ ] Add `setLastDismissed()`

**File:** `src/App.svelte` (updates)

- [ ] Add InstallPrompt component

**File:** `src/lib/stores/layout.svelte.ts` (updates)

- [ ] Call `setUserInteracted()` after first rack created

**Tests:** `src/tests/installPrompt.test.ts`

- [ ] Test: Install prompt hidden when already installed
- [ ] Test: Install prompt hidden on first visit
- [ ] Test: Install prompt shown after 2+ visits with interaction
- [ ] Test: Dismiss hides prompt for 7 days
- [ ] Test: Install button triggers native prompt
- [ ] Test: Prompt hidden after successful install

**Commit:** `feat(pwa): add install prompt UI`

---

## Phase 7: Mobile Polish

### Prompt 7.1 — Touch Target Audit

**File:** `src/lib/utils/accessibility.ts`

- [ ] Define `TOUCH_TARGET_MIN = 48`
- [ ] Implement `checkTouchTarget()` function

**Components to audit/update:**

- [ ] ToolbarButton — ensure 48x48px
- [ ] ActionSheet buttons — ensure 48px height
- [ ] BottomSheet handle — 48px tap area
- [ ] RackNavigator buttons — 48x48px
- [ ] DeviceLibraryItem — 48px height minimum
- [ ] PositionSpinner buttons — 48x48px
- [ ] USlotTarget — extended tap area

**CSS updates:**

- [ ] Add `.toolbar-button` min dimensions
- [ ] Add `.tap-extend::before` for invisible tap area

**U slot tap targets:**

- [ ] Extend invisible tap area to 48px

**Visual feedback:**

- [ ] Add `:active` state for all tappable elements

**Tests:** `src/tests/touchTargets.test.ts`

- [ ] Test: All toolbar buttons meet 48px minimum
- [ ] Test: All action sheet items meet 48px minimum
- [ ] Test: U slot targets have extended tap area
- [ ] Test: Device library items meet 48px minimum
- [ ] Test: Navigation buttons meet 48px minimum

**Commit:** `fix(a11y): ensure all touch targets meet 48px minimum`

---

### Prompt 7.2 — Responsive Forms

**File:** `src/lib/components/Dialog.svelte` (updates)

- [ ] Add `fullScreenOnMobile` prop
- [ ] Add mobile full-screen styling

**File:** `src/lib/components/NewRackForm.svelte` (updates)

- [ ] Larger input fields (48px height)
- [ ] Radio buttons as large tappable cards
- [ ] Full-width buttons
- [ ] Numeric keyboard (`inputmode="numeric"`)

**File:** `src/lib/components/AddDeviceForm.svelte` (updates)

- [ ] Full-screen on mobile
- [ ] Category as scrollable card grid
- [ ] Color picker as swatches grid
- [ ] Large touch-friendly inputs

**File:** `src/lib/components/MobileInput.svelte`

- [ ] Create touch-optimized input wrapper
  - [ ] 48px minimum height
  - [ ] Clear button for text
  - [ ] Proper `inputmode` attributes
  - [ ] Label positioning

**File:** `src/lib/components/RadioCardGroup.svelte`

- [ ] Create touch-friendly radio component
  - [ ] Large tappable cards
  - [ ] Visual selection state
  - [ ] Grid layout on mobile

**Tests:** `src/tests/mobileForms.test.ts`

- [ ] Test: Dialog renders full-screen on mobile
- [ ] Test: Inputs have 48px minimum height on mobile
- [ ] Test: Radio cards are tappable
- [ ] Test: Numeric inputs show numeric keyboard
- [ ] Test: Forms scroll properly when keyboard open

**Commit:** `feat(forms): optimize forms for mobile viewports`

---

### Prompt 7.3 — Mobile Toasts and Feedback

**File:** `src/lib/components/ToastContainer.svelte` (updates)

- [ ] Add mobile positioning (bottom-center, above sheet)
- [ ] Add media query for mobile styles

**File:** `src/lib/components/Toast.svelte` (updates)

- [ ] Add full width on mobile
- [ ] Add larger dismiss touch target
- [ ] Add swipe to dismiss gesture

**Placement toast:**

- [ ] Create persistent toast for placement mode
- [ ] Show device name and action hint
- [ ] Add Cancel button

**File:** `src/lib/stores/toast.svelte.ts` (updates)

- [ ] Add shorter default duration on mobile (3s vs 5s)
- [ ] Add max 2 visible toasts on mobile
- [ ] Add queue management
- [ ] Add placement toast special handling

**Tests:** `src/tests/mobileToasts.test.ts`

- [ ] Test: Toasts position above bottom sheet on mobile
- [ ] Test: Toasts full width on mobile
- [ ] Test: Swipe dismisses toast
- [ ] Test: Max 2 toasts visible on mobile
- [ ] Test: Placement toast persists during placement mode
- [ ] Test: Placement toast cancel button works

**Commit:** `feat(feedback): optimize toasts for mobile`

---

## Phase 8: Testing & Integration

### Prompt 8.1 — Mobile E2E Tests

**File:** `playwright.config.ts` (updates)

- [ ] Add Mobile Safari project (iPhone 14)
- [ ] Add Mobile Chrome project (Pixel 7)
- [ ] Add Mobile Safari SE project (iPhone SE)

**File:** `tests/e2e/mobile-basic.spec.ts`

- [ ] Test: Create rack on mobile
- [ ] Test: Verify rack appears in single rack view
- [ ] Test: Navigate between racks with swipe
- [ ] Test: Navigate between racks with buttons
- [ ] Test: Open menu and access all actions
- [ ] Test: Toggle theme from menu

**File:** `tests/e2e/mobile-placement.spec.ts`

- [ ] Test: Open device library sheet
- [ ] Test: Search for device
- [ ] Test: Tap device to select for placement
- [ ] Test: Verify toast shows placement hint
- [ ] Test: Tap U slot to place device
- [ ] Test: Verify device appears in rack
- [ ] Test: Cancel placement flow
- [ ] Test: Error feedback on invalid placement

**File:** `tests/e2e/mobile-gestures.spec.ts`

- [ ] Test: Pinch to zoom in
- [ ] Test: Pinch to zoom out
- [ ] Test: Double-tap to reset zoom
- [ ] Test: Swipe left navigates to next rack
- [ ] Test: Swipe right navigates to previous rack
- [ ] Test: Long-press initiates drag mode

**File:** `tests/e2e/mobile-pwa.spec.ts`

- [ ] Test: Manifest is valid
- [ ] Test: Service worker registers
- [ ] Test: App works offline
- [ ] Test: Install prompt appears after criteria met

**File:** `tests/e2e/mobile-persistence.spec.ts`

- [ ] Test: Save layout downloads file
- [ ] Test: Load layout from file
- [ ] Test: Session storage preserves work

**Commit:** `test(e2e): add comprehensive mobile E2E tests`

---

### Prompt 8.2 — Device Testing Matrix

**File:** `tests/device-matrix.md`

- [ ] Create manual testing checklist
- [ ] Document primary devices (must pass)
  - [ ] iPhone SE (375×667)
  - [ ] iPhone 14 (390×844)
  - [ ] Pixel 7 (412×915)
  - [ ] Samsung Galaxy S21 (360×800)
- [ ] Document secondary devices (should pass)
  - [ ] iPhone 14 Pro Max (430×932)
  - [ ] iPad Mini (768×1024)
- [ ] Document test scenarios per device

**Visual regression:**

- [ ] Capture baseline screenshots
  - [ ] Mobile toolbar
  - [ ] Device library sheet states
  - [ ] Single rack view
  - [ ] Placement mode
  - [ ] Edit sheet
  - [ ] Forms

**File:** `KNOWN_ISSUES.md`

- [ ] Document iOS Safari quirks
- [ ] Document Android Chrome quirks
- [ ] Document gesture conflicts
- [ ] Document safe area edge cases

**File:** `README.md` (updates)

- [ ] Add mobile testing instructions

**Commit:** `test(devices): add device testing matrix and documentation`

---

### Prompt 8.3 — Final Integration and Polish

**Performance audit:**

- [ ] Run Lighthouse mobile audit
- [ ] Target Performance > 90
- [ ] Target Accessibility > 95
- [ ] Target Best Practices > 90
- [ ] Target PWA all green
- [ ] Fix any issues found

**Success criteria verification:**

- [ ] User can create racks on mobile phone
- [ ] User can place devices using two-tap flow
- [ ] User can move devices within and between racks
- [ ] User can edit device and rack properties via sheet
- [ ] User can navigate between racks via swipe or buttons
- [ ] User can zoom canvas via pinch gesture
- [ ] User can save/load layouts on mobile
- [ ] User can export images on mobile
- [ ] PWA is installable to home screen
- [ ] App works fully offline
- [ ] All touch targets meet 48px minimum
- [ ] All mobile gestures have immediate visual feedback
- [ ] Desktop experience unchanged
- [ ] Hammer.js integrated for gesture handling
- [ ] Pinch-to-zoom integrates with panzoom smoothly
- [ ] No gesture conflicts between Hammer.js and panzoom

**Desktop verification:**

- [ ] Run full E2E suite on desktop
- [ ] All existing tests pass
- [ ] No visual regressions
- [ ] Drag-and-drop still works
- [ ] Keyboard shortcuts still work

**Code cleanup:**

- [ ] Remove console.log statements
- [ ] Remove/document TODO comments
- [ ] No TypeScript errors
- [ ] No linting warnings

**Version update:**

- [ ] Update version to 0.3.0 in package.json
- [ ] Update version in constants.ts
- [ ] Update CHANGELOG.md
- [ ] Update README.md
- [ ] Update help panel content

**Commit:** `chore: v0.3.0 release preparation`

---

## Post-Implementation Checklist

- [ ] All 24 prompts completed
- [ ] All unit tests passing
- [ ] All E2E tests passing (desktop + mobile)
- [ ] Manual testing on primary devices complete
- [ ] Lighthouse scores meet targets
- [ ] Documentation updated
- [ ] CHANGELOG updated
- [ ] Version bumped to 0.3.0
- [ ] Git tag created: `v0.3.0`
- [ ] Pushed to primary repository
- [ ] Pushed to mirror repository

---

## Quick Reference

### Key Files Created

| File                                           | Purpose               |
| ---------------------------------------------- | --------------------- |
| `src/lib/utils/platform.ts`                    | Platform detection    |
| `src/lib/stores/platform.svelte.ts`            | Platform state        |
| `src/lib/components/BottomSheet.svelte`        | Base bottom sheet     |
| `src/lib/components/DeviceLibrarySheet.svelte` | Mobile device library |
| `src/lib/components/EditSheet.svelte`          | Mobile edit panel     |
| `src/lib/components/RackNavigator.svelte`      | Rack navigation       |
| `src/lib/components/SingleRackView.svelte`     | Mobile canvas         |
| `src/lib/utils/hammer.ts`                      | Hammer.js wrapper     |
| `src/lib/actions/gestures.ts`                  | Gesture Svelte action |
| `src/lib/components/USlotTarget.svelte`        | Tap targets           |
| `src/lib/utils/haptics.ts`                     | Haptic feedback       |
| `public/manifest.json`                         | PWA manifest          |
| `public/sw.js`                                 | Service worker        |
| `src/lib/components/InstallPrompt.svelte`      | PWA install UI        |

### Dependencies Added

```json
{
	"@egjs/hammerjs": "^2.0.17"
}
```

### CSS Custom Properties Added

```css
--breakpoint-phone: 480px --breakpoint-tablet: 768px --breakpoint-desktop: 1024px
	--touch-target-min: 48px --mobile-toolbar-height: 56px --mobile-bottom-sheet-handle: 32px
	--mobile-rack-navigator-height: 48px --safe-area-top/bottom/left/right;
```

---

_This checklist tracks implementation of v0.3.0 Mobile & PWA support._
_Mark items complete as you progress through each prompt._
